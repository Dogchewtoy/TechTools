BRKDCT-3100


General CLI

	show cli list (lists show/debug commands available, can be grepped, piped, and excluded for a particular subsection)


Log Entry/Strange Error Investigation

FSM (Finite State Machine Event History)

	show system internal ethpm event-history int ethX/Y
	show lacpinternal event-history interface ethX/y

Debug
	debug logfile logfile.log
	debug system (for example "debug spanning-tree bpdu_rx tree 100") - file is stored in filesystem and can be transferred off
	undebug all (turn off debugging)

Message Transaction Service (MTS) - IPC
	show system internal mts buffers (buffers used should be in single digits)
	show system internal mts buffers detail (look for long ages)
	show system internal mts sup sap NNN description (NNN is the process listed in previous commands)
	

Crash Investigation
	show system reset-reason
	show cores (list coredump files generated by crash, stored in RAM)
	copy core://(module-number)/(process-id)/(instance) tftp://, bootflash:/, ftp://, etc.
	show processes log
	show processes log pid NNNN (where NNNN is process id that crashed)
	
High CPU
	show policy-map interface control-plane (show copp statistics)
	show platform afm info copp-tbls (similar to above but with more info) - CoPP template can be customized, generally not necessary
	show processes cpu sort (adding " | exclude 0.0" only shows process using CPU)
	show system resources
	show processes cpu history
	
	Ethanalyzer (onboard packet capture, can capture control plane traffic (mgmt0, eth3, eth4)
		ethanalyzer local interface (inbound-lo(eth3), inbound-hi(eth4), mgmt (mgmt0)
		ethanalyzer local interface inbound-lo (capture-filter, detail, write, etc.) "ethanalyzerlocal interface mgmtwrite bootflash:mgmt.pcap"



CRC Errors
	show hardware internal bigsur port ethernetX/Y counters rx | include CRC (look for Stomped Frames on the interface suspected of recieving bad frames from host)
	show hardware internal bigsur port ethernetX/Y counters rx | incFRAME (look for Frame Errors on egress interface (our Output Errors on old code))
	show hardware internal bigsur port ethernetX/Y counters rx | include MTU (switch recieves jumbo frame on 1500 MTU port, trucates and stomps CRC, look for MTU violation)

	Look for incrementing RX CRC errors - that is the source.  If no source, local switch is origin of CRC errors, check cables and remote host on RX port


Informational Show Commands
	show hardware internal bigsur all-ports
	show platform afminfo global| begin Vlan (display external to internal VLAN mapping)
	show hardware internal bcm-usd info port-info (5500 series with L3 daughtercard)

Forwarding Manager Commands
	show platform fwm info vlanif X ethX/Y (show stp interface state for specified vlan)
	show platform fwm info hw-stm asic X | grep XXXX.XXXX (show mac address to ASIC association)
	show platform fwminfo mac MAC.ADDRESS (show the information the system has learned about a particular MAC address and statistics)
	show platform fwminfo pif ethernetX/Y (can be grepped for specific information)
	show platform fwminfo asic-errors 1
	
Layer 3 Commands
	show hsrp brief
	show hsrp N (N is the HSRP group number, group number should be unique within a VLAN)
	show interface vlan N (show SVI status)
	show hsrp interface vlan N
	show platform fwminfo l3lif vlan NN (show forwarding information for SVI, can grep for specific interface)
	show system internal forwarding myiprtable (show MAC address information for forwarding interfaces)
	show ip route (basic route check, does a route exist?)
	show ip arp (have we resolved the L2 address of the L3 next hop)
	show forwarding route NN.NN.NN.NN/NN (show fib entries for specified route)
	show forwarding adjacency NN.NN.NN.NN (check MAC to interface mapping for a specific next hop)
	TCAM Full
		show ip route summary
		show hardware profile status

Buffer Commands
	Buffer is adjustable, should not be necessary
	Congested Unicast traffic is dropped at Ingress 
	Congested Multicast/Broadcast traffic is dropped at Egress 
	show queuing interface ethernetX/Y (compare ingress and egress port statistics)
	show platform software qd info counters voq interface ethernetX/Y (show tail drops from interface congestion, also can be used to view ASIC)


Embedded Logic Analyzer(ELAM) - captures the first packet of a specified flow
	elam slot 1 asic bigsur instance 1 (also slot all/asic all/carmel for 5500 switches if applicable)
		trigger luingress ipv4 if source-ipv4-address_ipv4 x.x.x.x destination-ipv4-address_ipv4 x.x.x.x (customizable)	
		show capture lu
		show capture rs
	
	














